Bootstrap: docker
From: debian

%labels
    Negro-Tirri
    Version 1.0
    Description Matrix Multiplication Program with CMake and MPI

%environment
    # Set environment variables
    export PATH=/usr/local/bin:$PATH
    echo "tzdata tzdata/Areas select Etc" | sudo debconf-set-selections
    echo "tzdata tzdata/Zones/Etc select UTC" | sudo debconf-set-selections
    export DEBIAN_FRONTEND=noninteractive

%post
    export DEBIAN_FRONTEND=noninteractive

    # Update and install required packages
    apt-get update && apt-get install -y \
        cmake \
        build-essential \
        libgtest-dev \
        mpich \
        git \
        tzdata \
        openmpi-bin \
        openmpi-common \
        libopenmpi-dev

    # Install Google Test
    cd /usr/src/gtest
    cmake CMakeLists.txt
    make
    mv lib/*.a /usr/lib
    # Clean up
    apt-get clean && rm -rf /var/lib/apt/lists/*

%files
    # Copy the CMake project files to the container
    CMakeLists.txt /project/CMakeLists.txt
    include/ /project/
    src/ /project/
    test/ /project/
    googletest/ /project/
    lib/ /project/

%test
    # Command to test the application
    cd /project/
    cmake .
    make
    ctest -C Release --output-on-failure
